<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Codenem</title>
</head>
<body>
  <div class="loader loader--hidden">
    <div class="loader__progress">
      <div class="loader__progress__bar"></div>
    </div>  
  </div>
  
  <div class="app"></div>

  <div class="credits">
    <h1 class="credits__title">shaolin405</h1>
    <p class="credits__wrapper">
      <a href="https://twitter.com/avanderpotte" target="_blank" class="credits__link">avanderpotte</a> â˜“ <a href="https://twitter.com/leixng" target="_blank" class="credits__link">leixng</a>
    </p>
  </div>

  <script id="terrainVertexShader" type="x-shader/x-vertex">
    #define PHONG

    varying vec3 vViewPosition;
    uniform sampler2D bumpTexture;
    uniform float bumpScale;
    varying float vAmount;

    #ifndef FLAT_SHADED

      varying vec3 vNormal;

    #endif

    #include <common>
    #include <uv_pars_vertex>
    #include <uv2_pars_vertex>
    #include <displacementmap_pars_vertex>
    #include <envmap_pars_vertex>
    #include <color_pars_vertex>
    #include <fog_pars_vertex>
    #include <morphtarget_pars_vertex>
    #include <skinning_pars_vertex>
    #include <shadowmap_pars_vertex>
    #include <logdepthbuf_pars_vertex>
    #include <clipping_planes_pars_vertex>

    void main() {

      #include <uv_vertex>
      #include <uv2_vertex>
      #include <color_vertex>

      #include <beginnormal_vertex>
      #include <morphnormal_vertex>
      #include <skinbase_vertex>
      #include <skinnormal_vertex>
      #include <defaultnormal_vertex>

      #include <begin_vertex>
      #include <displacementmap_vertex>
      #include <morphtarget_vertex>
      #include <skinning_vertex>
      #include <project_vertex>
      #include <logdepthbuf_vertex>
      #include <clipping_planes_vertex>

      #include <worldpos_vertex>
      #include <envmap_vertex>
      #include <shadowmap_vertex>

      vNormal = normal;

      vec4 bumpData = texture2D( bumpTexture, uv );
      
      vAmount = bumpData.r; // assuming map is grayscale it doesn't matter if you use r, g, or b.
      
      // move the position along the normal
      vec3 newPosition = position + normal * bumpScale * vAmount;
      
      gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );

    }
  </script>
  
  <script id="terrainFragmentShader" type="x-shader/x-fragment">
    
    #define PHONG
    
    uniform vec3 diffuse;
    uniform vec3 emissive;
    uniform vec3 specular;
    uniform float shininess;
    uniform float opacity;

    #include <common>
    #include <packing>
    #include <dithering_pars_fragment>
    #include <color_pars_fragment>
    #include <uv_pars_fragment>
    #include <uv2_pars_fragment>
    #include <map_pars_fragment>
    #include <alphamap_pars_fragment>
    #include <aomap_pars_fragment>
    #include <lightmap_pars_fragment>
    #include <emissivemap_pars_fragment>
    #include <envmap_pars_fragment>
    #include <gradientmap_pars_fragment>
    #include <fog_pars_fragment>
    #include <bsdfs>
    #include <lights_pars>
    #include <lights_phong_pars_fragment>
    #include <shadowmap_pars_fragment>
    #include <bumpmap_pars_fragment>
    #include <normalmap_pars_fragment>
    #include <specularmap_pars_fragment>
    #include <logdepthbuf_pars_fragment>
    #include <clipping_planes_pars_fragment>

    void main() {

      #include <clipping_planes_fragment>

      vec4 diffuseColor = vec4( diffuse, opacity );
      ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
      vec3 totalEmissiveRadiance = emissive;

      #include <logdepthbuf_fragment>
      #include <map_fragment>
      #include <color_fragment>
      #include <alphamap_fragment>
      #include <alphatest_fragment>
      #include <specularmap_fragment>
      #include <normal_fragment>
      #include <emissivemap_fragment>

      // accumulation
      #include <lights_phong_fragment>
      #include <lights_template>

      // modulation
      #include <aomap_fragment>

      vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;

      #include <envmap_fragment>

      gl_FragColor = vec4( outgoingLight, diffuseColor.a );

      #include <tonemapping_fragment>
      #include <encodings_fragment>
      #include <fog_fragment>
      #include <premultiplied_alpha_fragment>
      #include <dithering_fragment>

    }

  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/87/three.min.js"></script>
  <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/127738/OrbitControls.js"></script>
  <script src="https://threejs.org/examples/js/loaders/OBJLoader.js"></script>
  <script type="x-shader/vertex-shader" id="checkpointVertex">
    precision mediump float;
    varying vec2 vPos;
    void main() {
      vPos = position.xy;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }
  </script>
  <script type="x-shader/fragment-shader" id="checkpointFragment">
    precision mediump float;
    varying vec2 vPos;
    uniform float uTime;
    uniform float uRadiusOuter;
    uniform float uStrokeOuter;
    uniform float uShift;
    uniform float uStrokeInner;
    uniform vec3 uColor;
    
    float map( float value, float low1, float high1, float low2, float high2 ) {
      return low2 + ( value - low1 ) * ( high2 - low2 ) / ( high1 - low1 );      
    }
    
    void main() {
      float radiusInner = uRadiusOuter - uStrokeOuter - uShift;
      float d = distance( vPos.xy, vec2( .5 ) );
      float alphaShift = map( sin( uTime ), -1., 1., 5., 30. );
      float a = 0.3 - map( d, ( uRadiusOuter - uStrokeOuter ) - alphaShift, uRadiusOuter, 0., 0.3 );
      //float strokeInner = uStrokeInner + 0.5 * ( 0.5 + sin( uTime ) * 0.5 );
      if ( d <= uRadiusOuter && d > uRadiusOuter - uStrokeOuter ) gl_FragColor = vec4( uColor, a );
      else if ( d <= radiusInner && d > radiusInner - uStrokeInner ) gl_FragColor = vec4( uColor, 1. );
      else discard;
    }
  </script>
  <script src="app.bundle.js"></script>
  
</body>
</html>